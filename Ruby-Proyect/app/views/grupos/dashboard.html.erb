<section class="dashboard-home-modern">
  <!-- Hero Banner -->
  <div id="heroCarousel" class="carousel slide mb-4" data-bs-ride="carousel" data-bs-interval="3000">
    <div class="carousel-inner">
      <% if Banner.any? %>
        <% Banner.order(:id).each_with_index do |banner, index| %>
          <% if banner.imagen.attached? %>
            <div class="carousel-item <%= 'active' if index == 0 %>">
              <%= image_tag banner.imagen, class: "d-block w-100 banner-img", alt: "Banner #{index + 1}" %>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="carousel-item active">
          <%= image_tag "LogoLogoText.svg", class: "d-block w-100 banner-img", alt: "Banner por defecto" %>
        </div>
      <% end %>
    </div>
    
    <!-- Indicadores (punticos) -->
    <% if Banner.any? %>
      <div class="carousel-indicators">
        <% Banner.order(:id).each_with_index do |banner, index| %>
          <% if banner.imagen.attached? %>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="<%= index %>" 
                    class="<%= 'active' if index == 0 %>" aria-current="<%= 'true' if index == 0 %>" 
                    aria-label="Slide <%= index + 1 %>"></button>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" 
                class="active" aria-current="true" aria-label="Slide 1"></button>
      </div>
    <% end %>
    
    <!-- Controles Bootstrap -->
    <% if Banner.count > 1 %>
      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
    <% end %>
  </div>

<script>
(function() {
    'use strict';
    
    function initCarousel() {
        const carousel = document.getElementById('heroCarousel');
        if (!carousel) return;
        
        // Destruir instancia previa si existe
        const existingInstance = bootstrap.Carousel.getInstance(carousel);
        if (existingInstance) {
            existingInstance.dispose();
        }
        
        // Crear nueva instancia
        new bootstrap.Carousel(carousel, {
            interval: 3000,
            ride: 'carousel',
            pause: 'hover',
            wrap: true
        });
    }
    
    // Ejecutar solo una vez
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCarousel);
    } else {
        initCarousel();
    }
    
    // Para Turbo
    document.addEventListener('turbo:load', initCarousel);
})();
</script>


  <!-- Secci√≥n de Combos Premium -->
  <section class="combos-premium">
    <div class="container">
      <div class="section-header">
        <div class="header-content">
          <span class="section-badge"><%= t("home.section.ofertas")%></span>
          <h2 class="section-title"><%= t("home.section.combos_exclusivos")%></h2>
          <p class="section-subtitle"><%= t("home.section.ahorra")%></p>
        </div>
        <% if @combos.any? %>
          <%= link_to "Ver Todos", "/combos", class: "view-all-btn" %>
        <% end %>
      </div>

      <div class="combos-grid">
        <% if @combos.any? %>
          <% @combos.each_with_index do |combo, index| %>
            <div class="combo-card-premium" data-aos="fade-up" data-aos-delay="<%= index * 100 %>">
              <div class="combo-image-container">
                <div class="img-wrapper shimmer">
                    <div class="img-loader"></div>
                    <img
                      src="<%= combo.imagen.attached? ? url_for(combo.imagen_resized) : asset_path('LogoLogoText2.svg') %>"
                      alt="<%= combo.nombre %>"
                      class="product-image"
                      style="outline-offset: 0;"
                      onload="imageLoaded(this)"
                      onerror="imageError(this)"
                    >
                  </div>
                
              </div>
              
              <div class="combo-content">
                <h3 class="combo-name"><%= combo.nombre %></h3>
                <p class="combo-description">
                  <%= combo.descripcion.present? ? truncate(combo.descripcion, length: 60) : "Deliciosa combinaci√≥n de sabores √∫nicos" %>
                </p>
                
                <% if combo.is_a?(Combo) && combo.combo_items.any? %>
                  <div class="combo-items-preview">
                    <span class="items-count">üçΩÔ∏è <%= combo.combo_items.sum(:cantidad) %> productos incluidos</span>
                  </div>
                <% end %>
                
                <div class="combo-footer">
                  <div class="combo-price">
                    <span class="price-label">Solo</span>
                    <span class="price-value"><%= number_to_currency(combo.precio, unit: "COP $", separator: ",", delimiter: ".", precision: 0) %></span>
                  </div>

                  <%= button_to t("home.carrito.pedir_ahora"), carrito_items_path(product_id: combo.id), 
                    method: :post, 
                    class: "combo-btn-premiums",
                    data: { turbo_frame: "_top" } %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="no-combos-premium">
            <div class="no-combos-icon">üéÅ</div>
            <h3><%= t("home.section.proxima")%></h3>
            <p><%= t("home.section.estamos_preparados")%></p>
            <%= link_to t("home.section.explorar_menu"), grupos_path, class: "explore-menu-btn" %>
          </div>
        <% end %>
      </div>
    </div>
  </section>

  <!-- Secci√≥n de Informaci√≥n Premium -->
  <section class="info-premium">
    <div class="container">
      <div class="info-grid">
        <!-- Contacto Premium -->
        <div class="contact-premium">
          <div class="contact-header">
            <h2>üìû <%= t("home.section.contactanos")%></h2>
            <p><%= t("home.section.servir")%></p>
          </div>
          
          <div class="contact-items">
            <article class="contact-item">
              <div class="contact-icon email">
                üìß
              </div>
              <div class="contact-info">
                <h4>Email</h4>
                <a href="mailto:biteviasoftware@gmail.com">biteviasoftware@gmail.com</a>
              </div>
            </article>
            
            <article class="contact-item">
              <div class="contact-icon whatsapp">
                üì±
              </div>
              <div class="contact-info">
                <h4>WhatsApp</h4>
                <a href="https://wa.me/573024681298">+57 302 468 1298</a>
              </div>
            </article>
            
            <article class="contact-item">
              <div class="contact-icon location">
                üìç
              </div>
              <div class="contact-info">
                <h4><%= t("home.section.ubicacion")%></h4>
                <p>Calle 30 #3e-164, Barranquilla, Atl√°ntico</p>
              </div>
            </article>
          </div>
        </div>

        <!-- Mapa Premium -->
        <div class="map-premium">
          <div class="map-header">
            <h3>üó∫Ô∏è <%= t("home.section.encuentranos")%></h3>
            <p><%= t("home.section.visitar")%></p>
          </div>
          <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3917.2743398504213!2d-74.7857876249557!3d10.942637289216423!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8ef5d390bce185a1%3A0x7b668739ec70f4b4!2sSENA%20CENTRO%20INDUSTRIAL%20Y%20DE%20AVIACION!5e0!3m2!1ses!2sco!4v1750989006175!5m2!1ses!2sco" 
                    width="100%" height="300" style="border:0;border-radius: 15px;" 
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          </div>
        </div>
      </div>
    </div>
  </section>
</section>
