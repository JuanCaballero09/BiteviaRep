<section>
    <h2>Agregar imagen al Banner</h2>

    <%= form_with model: [:dashboard, @banner], local: true, html: { class: "dashboard-form" } do |f| %>
        
        <div class="field">
            <%= f.label :imagen, "Imagen del Banner" %>
            <br>
            <div class="banner-info-grid">
                <div class="info-card">
                    <span class="info-icon">üìê</span>
                    <div>
                        <strong>Relaci√≥n de Aspecto</strong>
                        <p>19:9 (Panor√°mico)</p>
                        <small>Se adapta autom√°ticamente</small>
                    </div>
                </div>
                <div class="info-card">
                    <span class="info-icon">üñºÔ∏è</span>
                    <div>
                        <strong>Dimensiones Recomendadas</strong>
                        <p>1920 x 911 p√≠xeles</p>
                        <small>O cualquier m√∫ltiplo de 19:9</small>
                    </div>
                </div>
                <div class="info-card">
                    <span class="info-icon">‚ú®</span>
                    <div>
                        <strong>Peso del Archivo</strong>
                        <p>M√°ximo 5MB</p>
                        <small>JPG, PNG, WebP</small>
                    </div>
                </div>
            </div>
            <br>
            <%= f.file_field :imagen, accept: "image/*", id: "banner-image-input" %>
        </div>

        <div id="banner-preview-container" style="display: none; margin: 30px 0;">
            <h3 style="margin-bottom: 20px;">Vista Previa del Banner</h3>
            
            <div class="preview-grid">
                <div class="preview-item">
                    <h4>Aspecto 19:9 Responsive</h4>
                    <div class="banner-preview-wrapper">
                        <img class="banner-preview" src="" alt="Vista Banner">
                    </div>
                </div>
            </div>
            
            <p id="banner-dimensions-display" style="margin-top: 20px; font-size: 14px; color: #666; text-align: center;"></p>
        </div>

        <div>
            <%= f.submit "Subir imagen" %>
            <%= link_to 'Volver', dashboard_banners_path %>
        </div>
    <% end %>
</section>

<style>
.banner-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin: 15px 0;
}

.info-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 18px;
    border-radius: 12px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.info-icon {
    font-size: 32px;
    flex-shrink: 0;
}

.info-card strong {
    display: block;
    font-size: 16px;
    margin-bottom: 6px;
    font-weight: 600;
}

.info-card p {
    margin: 0 0 4px 0;
    font-size: 13px;
    opacity: 0.95;
    line-height: 1.4;
}

.info-card small {
    display: block;
    font-size: 11px;
    opacity: 0.75;
    font-style: italic;
}

.preview-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    max-width: 900px;
    margin: 0 auto;
}

.preview-item {
    text-align: center;
}

.preview-item h4 {
    font-size: 16px;
    color: #667eea;
    margin-bottom: 15px;
    font-weight: 600;
}

.banner-preview-wrapper {
    overflow: hidden;
    border: 2px solid #ddd;
    border-radius: 12px;
    background: #f5f5f5;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    aspect-ratio: 19 / 9;
    width: 100%;
}

.banner-preview {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

@media (max-width: 1024px) {
    .banner-info-grid,
    .preview-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function initBannerPreview() {
    const imageInput = document.getElementById('banner-image-input');
    const previewContainer = document.getElementById('banner-preview-container');
    const previewImages = document.querySelectorAll('.banner-preview');
    const dimensionsDisplay = document.getElementById('banner-dimensions-display');
    
    if (imageInput) {
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const img = new Image();
                    
                    img.onload = function() {
                        // Mostrar en la vista previa
                        previewImages.forEach(previewImg => {
                            previewImg.src = event.target.result;
                        });
                        previewContainer.style.display = 'block';
                        
                        // Calcular relaci√≥n de aspecto
                        const aspectRatio = (img.width / img.height).toFixed(2);
                        const isCorrectRatio = Math.abs(aspectRatio - 2.11) < 0.1; // 19/9 = 2.11
                        
                        // Mostrar dimensiones originales
                        dimensionsDisplay.innerHTML = `
                            üìè <strong>Dimensiones:</strong> ${img.width} x ${img.height} p√≠xeles | 
                            <strong>Relaci√≥n:</strong> ${aspectRatio}:1 
                            ${isCorrectRatio ? '‚úÖ' : '‚ö†Ô∏è (Recomendado: 19:9 = 2.11:1)'}
                        `;
                    };
                    
                    img.src = event.target.result;
                };
                
                reader.readAsDataURL(file);
            }
        });
    }
}

// Inicializar en DOMContentLoaded y turbo:load
document.addEventListener('DOMContentLoaded', initBannerPreview);
document.addEventListener('turbo:load', initBannerPreview);
</script>